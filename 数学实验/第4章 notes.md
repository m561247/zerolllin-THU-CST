### CH4 ODE求解

##### 数值微分的计算

前差公式：$f^{'}(a) = \frac{f(a+h) - f(a)}{h}$

后差公式：$f^{'}(a) = \frac{f(a) - f(a-h)}{h}$

中点公式：$f^{'}(a) = \frac{f(a+h)-f(a-h)}{2h}$

##### 误差分析

泰勒展开：$f(a\pm h) = f(a) \pm hf^{'}(a) + \frac{h^2}{2}f^{"}(a) \pm O(h^3)$

因此前差/后差公式的误差为 $O(h)$，中点公式的误差为 $O(h^2)$

区间左右端点：三点公式，误差也为 $O(h^2)$
$$
f^{'}(x_0) = \frac{-3y_0 + 4y_1 - y_2}{2h} \\
f^{'}(x_n) = \frac{y_{n-2} - 4y_{n-1} - 3y_n}{2h}
$$


##### MATLAB

diff 计算差分，gradient 计算导数

##### ODE数值解法

求 ODE  $y^{'} = f(x, y), \space y(x_0) = y+0$  在等间距点 $x_1, x_2, ..., x_n$ 的近似解

##### 欧拉方法

向前欧拉公式：$y_{n+1} = y_n + hf(x_n, y_n)$

向后欧拉公式：$y_{n+1} = y_n + hf(x_{n+1}, y_{n+1})$  初始 $y_{n+1}^{(0)} = y_n + hf(x_n, y_n)$ 迭代求解 $y_{n+1}^{(k)}$

而这平均得到梯形公式：$y_{n+1} = y_n + \frac{h}{2}[f(x_n, y_n) + f(x_{n+1}, y_{n+1})]$

改进欧拉公式：梯形公式，仅迭代一次

预测：$\overline{y}_{n+1} = y_n + hf(x_n, y_n)$

校正：$y_{n+1} = y_n + \frac{h}{2}[f(x_n, y_n) + f(x_{n+1}, \overline{y}_{n+1})]$

##### 误差分析

每一步计算都存在误差，最终得到累积误差

局部截断误差：假设每一步中公式右端准确，则左端的误差

$y(x_{n+1}) = y(x_n + h)$ 在 $x_n$ 处泰勒展开：
$$
y(x_{n+1}) = y(x_n) + hy^{'}(x_n) + \frac{h^2}{2}y^{"}(x_n) + O(h^3)
$$
向前/向后欧拉公式的误差为 $\pm \frac{h^2}{2}y^{"}(x_n)$，为1阶精度

梯形公式/改进欧拉公式的误差为 $-\frac{h^3}{12}y^{'''}(x_n)$，为2阶精度

##### 收敛性和整体误差

向前/向后欧拉公式的整体误差为 $O(h)$，4阶龙格-库塔方法的整体误差为 $O(h^4)$

##### 龙格-库塔（RK）方法

在 $[x_n, x_{n+1}]$ 之间多取几个点，计算导数的加权平均作为 $f(x, y(x))$

##### MATLAB

ode45 计算 (4, 5) 阶龙格-库塔公式

y = ode45(@f, ts, x0, opt) 

参数 opt = odeset('RelTol', 1e-6, 'AbsTol', 1e-9)

##### 数值算法稳定性

稳定性：计算中舍入误差不会随步数的增加无限增大，即 $|\epsilon_{n+k}| \le |\epsilon_{n}|$

等价于 $y^{'} = -\lambda y, \space y > 0$ （特征根 $-\lambda $）满足 $\lambda > 0$

向前欧拉公式：$\epsilon_{n+1} = (1-\lambda  h)\epsilon_n$ ，因此需要满足 $h \le 2/\lambda$

向后欧拉公式：$\epsilon_{n+1} =\frac{1}{1+\lambda  h}\epsilon_n$ ，$h$ 可以任意

经典龙格-库塔公式：$h \le 2.785/\lambda$

##### 刚性方程

振动系统的两个解（瞬态解，稳态解）的特征根相差很大

步长 $h$ 由瞬态解 $\lambda$ 决定，则稳态解需要很多步迭代，积分区间很长
