### lab4 实验报告

张一可 2021010793 计15

#### ch6 编程作业

**sys_linkat**：在 easy-fs 中，增加 root_inode 的 link 方法。根据旧文件路径 old_path 找到对应的 inode id，在 root_inode 目录中新建 DirEntry 目录项，写入 old_path 对应的 inode id 和新文件路径 new_path

**sys_unlinkat**：在 easy-fs 中，增加 root_inode 的 unlink 方法。根据文件名找到对应的 DirEntry 位置，将 root_inode 的对应目录项置为无效。统计对应 inode id 在 root_inode 目录中存在的个数，当个数减为 0 时，找到 inode id 对应的 inode，使用 clear_size 方法将其清除。

**sys_fstat**：在 easy-fs 中，增加 root_inode 的 get_fstat 方法。遍历 root_inode，得到 inode id、引用计数 nlink 信息，最后读取 inode id 对应的 inode，判断 inode 类型是文件还是目录，作为 EFSStat 结构体返回。最后在 os 中，将 EFSStat 信息中的变量值写入用户地址空间中的对应位置。



#### ch6 问答作业

1. **在我们的 easy-fs 中，root inode 起着什么作用？如果 root inode 中的内容损坏了，会发生什么？**

   root inode 是根目录节点，用来记录文件系统中的所有目录结构，完成根据文件名对文件 inode 的定位。
   
   如果 root inode 损坏，将会导致无法正确定位、打开和读写文件，可能会读取垃圾数据，或造成空间泄漏。
   
   

#### ch7 问答作业

1. **举出使用 pipe 的一个实际应用的例子。**

   linux 终端中，| 可以用管道连接两条命令，将前一条命令的输出，利用管道传输给后一条命令的输入

   如 `cat a.txt | wc -l` 将 a.txt 的内容通过管道传输到 wc 指令的输入，wc -l 对输入进行行数统计，从而我们可以利用管道完成对文件的行数统计。

2. **如果需要在多个进程间互相通信，则需要为每一对进程建立一个管道，非常繁琐，请设计一个更易用的多进程通信机制。**

   可以通过共享内存机制完成多进程间的通信。通信的多个进程之间无需具有父子关系，协商一致的 key 后即可将某一进程创建的共享内存段映射到每个进程的地址空间，完成多进程间的通信。

   也可以通过读写相同文件或利用网络套接字的方式进行多进程之间的通信。

   

#### 荣誉准则

1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 **以下各位** 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：无
2. 此外，我也参考了 **以下资料** ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：无
3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。
4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。

